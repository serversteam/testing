<?xml version="1.0" encoding="UTF-8"?>

<!--
/*********************************************************************************
 * The contents of this file are subject to the Common Public Attribution
 * License Version 1.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 * http://www.openemm.org/cpal1.html. The License is based on the Mozilla
 * Public License Version 1.1 but Sections 14 and 15 have been added to cover
 * use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be
 * consistent with Exhibit B.
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
 * the specific language governing rights and limitations under the License.
 *
 * The Original Code is OpenEMM.
 * The Original Developer is the Initial Developer.
 * The Initial Developer of the Original Code is AGNITAS AG. All portions of
 * the code written by AGNITAS AG are Copyright (c) 2007 AGNITAS AG. All Rights
 * Reserved.
 *
 * Contributor(s): AGNITAS AG.
 ********************************************************************************/
-->

<!--
  - Application context definition for Agnitas EMM business layer.
  - Contains bean references to the transaction manager and to the DAOs in
  - dataAccessContext.xml (see web.xml's "contextConfigLocation").
  
  *** IMPORTANT ***
  No Struts actions in this file!!!
  Use applicationContext-actions.xml instead!
  -->
<beans
	xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
	    http://www.springframework.org/schema/beans 
	    http://www.springframework.org/schema/beans/spring-beans.xsd
	    http://www.springframework.org/schema/context 
	    http://www.springframework.org/schema/context/spring-context.xsd">
	
	<context:component-scan base-package="org.agnitas"/>
	
	<bean id="databaseKeywordList" class="org.agnitas.util.KeywordList">
		<property name="keywords">
			<set>
				<value>ADD</value>
				<value>ALL</value>
				<value>ALTER</value>
				<value>ANALYZE</value>
				<value>AND</value>
				<value>AS</value>
				<value>ASC</value>
				<value>ASENSITIVE</value>
				<value>BEFORE</value>
				<value>BETWEEN</value>
				<value>BIGINT</value>
				<value>BINARY</value>
				<value>BLOB</value>
				<value>BOTH</value>
				<value>BY</value>
				<value>CALL</value>
				<value>CASCADE</value>
				<value>CASE</value>
				<value>CHANGE</value>
				<value>CHAR</value>
				<value>CHARACTER</value>
				<value>CHECK</value>
				<value>COLLATE</value>
				<value>COLUMN</value>
				<value>CONDITION</value>
				<value>CONSTRAINT</value>
				<value>CONTINUE</value>
				<value>CONVERT</value>
				<value>CREATE</value>
				<value>CROSS</value>
				<value>CURRENT_DATE</value>
				<value>CURRENT_TIME</value>
				<value>CURRENT_TIMESTAMP</value>
				<value>CURRENT_USER</value>
				<value>CURSOR</value>
				<value>DATABASE</value>
				<value>DATABASES</value>
				<value>DAY_HOUR</value>
				<value>DAY_MICROSECOND</value>
				<value>DAY_MINUTE</value>
				<value>DAY_SECOND</value>
				<value>DEC</value>
				<value>DECIMAL</value>
				<value>DECLARE</value>
				<value>DEFAULT</value>
				<value>DELAYED</value>
				<value>DELETE</value>
				<value>DESC</value>
				<value>DESCRIBE</value>
				<value>DETERMINISTIC</value>
				<value>DISTINCT</value>
				<value>DISTINCTROW</value>
				<value>DIV</value>
				<value>DOUBLE</value>
				<value>DROP</value>
				<value>DUAL</value>
				<value>EACH</value>
				<value>ELSE</value>
				<value>ELSEIF</value>
				<value>ENCLOSED</value>
				<value>ESCAPED</value>
				<value>EXISTS</value>
				<value>EXIT</value>
				<value>EXPLAIN</value>
				<value>FALSE</value>
				<value>FETCH</value>
				<value>FLOAT</value>
				<value>FLOAT4</value>
				<value>FLOAT8</value>
				<value>FOR</value>
				<value>FORCE</value>
				<value>FOREIGN</value>
				<value>FROM</value>
				<value>FULLTEXT</value>
				<value>GRANT</value>
				<value>GROUP</value>
				<value>HAVING</value>
				<value>HIGH_PRIORITY</value>
				<value>HOUR_MICROSECOND</value>
				<value>HOUR_MINUTE</value>
				<value>HOUR_SECOND</value>
				<value>IF</value>
				<value>IGNORE</value>
				<value>IN</value>
				<value>INDEX</value>
				<value>INFILE</value>
				<value>INNER</value>
				<value>INOUT</value>
				<value>INSENSITIVE</value>
				<value>INSERT</value>
				<value>INT</value>
				<value>INT1</value>
				<value>INT2</value>
				<value>INT3</value>
				<value>INT4</value>
				<value>INT8</value>
				<value>INTEGER</value>
				<value>INTERVAL</value>
				<value>INTO</value>
				<value>IS</value>
				<value>ITERATE</value>
				<value>JOIN</value>
				<value>KEY</value>
				<value>KEYS</value>
				<value>KILL</value>
				<value>LEADING</value>
				<value>LEAVE</value>
				<value>LEFT</value>
				<value>LIKE</value>
				<value>LIMIT</value>
				<value>LINES</value>
				<value>LOAD</value>
				<value>LOCALTIME</value>
				<value>LOCALTIMESTAMP</value>
				<value>LOCK</value>
				<value>LONG</value>
				<value>LONGBLOB</value>
				<value>LONGTEXT</value>
				<value>LOOP</value>
				<value>LOW_PRIORITY</value>
				<value>MATCH</value>
				<value>MEDIUMBLOB</value>
				<value>MEDIUMINT</value>
				<value>MEDIUMTEXT</value>
				<value>MIDDLEINT</value>
				<value>MINUTE_MICROSECOND</value>
				<value>MINUTE_SECOND</value>
				<value>MOD</value>
				<value>MODIFIES</value>
				<value>NATURAL</value>
				<value>NO_WRITE_TO_BINLOG</value>
				<value>NOT</value>
				<value>NULL</value>
				<value>NUMERIC</value>
				<value>ON</value>
				<value>OPTIMIZE</value>
				<value>OPTION</value>
				<value>OPTIONALLY</value>
				<value>OR</value>
				<value>ORDER</value>
				<value>OUT</value>
				<value>OUTER</value>
				<value>OUTFILE</value>
				<value>PRECISION</value>
				<value>PRIMARY</value>
				<value>PROCEDURE</value>
				<value>PURGE</value>
				<value>READ</value>
				<value>READS</value>
				<value>REAL</value>
				<value>REFERENCES</value>
				<value>REGEXP</value>
				<value>RELEASE</value>
				<value>RENAME</value>
				<value>REPEAT</value>
				<value>REPLACE</value>
				<value>REQUIRE</value>
				<value>RESTRICT</value>
				<value>RETURN</value>
				<value>REVOKE</value>
				<value>RIGHT</value>
				<value>RLIKE</value>
				<value>SCHEMA</value>
				<value>SCHEMAS</value>
				<value>SECOND_MICROSECOND</value>
				<value>SELECT</value>
				<value>SENSITIVE</value>
				<value>SEPARATOR</value>
				<value>SET</value>
				<value>SHOW</value>
				<value>SMALLINT</value>
				<value>SONAME</value>
				<value>SPATIAL</value>
				<value>SPECIFIC</value>
				<value>SQL</value>
				<value>SQL_BIG_RESULT</value>
				<value>SQL_CALC_FOUND_ROWS</value>
				<value>SQL_SMALL_RESULT</value>
				<value>SQLEXCEPTION</value>
				<value>SQLSTATE</value>
				<value>SQLWARNING</value>
				<value>SSL</value>
				<value>STARTING</value>
				<value>STRAIGHT_JOIN</value>
				<value>TABLE</value>
				<value>TERMINATED</value>
				<value>THEN</value>
				<value>TINYBLOB</value>
				<value>TINYINT</value>
				<value>TINYTEXT</value>
				<value>TO</value>
				<value>TRAILING</value>
				<value>TRIGGER</value>
				<value>TRUE</value>
				<value>UNDO</value>
				<value>UNION</value>
				<value>UNIQUE</value>
				<value>UNLOCK</value>
				<value>UNSIGNED</value>
				<value>UPDATE</value>
				<value>USAGE</value>
				<value>USE</value>
				<value>USING</value>
				<value>UTC_DATE</value>
				<value>UTC_TIME</value>
				<value>UTC_TIMESTAMP</value>
				<value>VALUES</value>
				<value>VARBINARY</value>
				<value>VARCHAR</value>
				<value>VARCHARACTER</value>
				<value>VARYING</value>
				<value>WHEN</value>
				<value>WHERE</value>
				<value>WHILE</value>
				<value>WITH</value>
				<value>WRITE</value>
				<value>XOR</value>
				<value>YEAR_MONTH</value>
				<value>ZEROFILL</value>
			</set>
		</property>
	</bean>

	<!-- ========================= GENERAL DEFINITIONS ========================= -->

	<!-- Configurer that replaces ${...} placeholders with values from properties files -->
	<!-- (in this case, mail and JDBC related properties) -->
	<bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:emm.properties</value>
			</list>
		</property>
		<property name="ignoreUnresolvablePlaceholders" value="true" />
	</bean>

	<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename">
			<value>messages</value>
		</property>
	</bean>

	<!-- ========================= BUSINESS OBJECT DEFINITIONS ======================== -->

	<!-- Velocity -->
	<bean id="VelocityWrapperCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>200</value>				<!--  cache size -->
		</constructor-arg>
		<constructor-arg index="1">
			<value>300000</value>			<!-- max retention time (ms) -->
		</constructor-arg>
	</bean>
	
	<bean id="CompanyContextVelocityChecker" class="org.agnitas.emm.core.velocity.checks.CompanyContextVelocityChecker" />
	
	<bean id="UberspectDelegateTargetFactory" class="org.agnitas.emm.core.velocity.UberspectDelegateTargetFactoryImpl">
		<property name="companyContextVelocityChecker" ref="CompanyContextVelocityChecker" />
	</bean>
	
	<bean id="VelocityWrapperFactory" class="org.agnitas.emm.core.velocity.VelocityWrapperFactoryImpl">
		<property name="velocityWrapperCache" ref="VelocityWrapperCache" />
		<property name="uberspectDelegateTargetFactory" ref="UberspectDelegateTargetFactory" />
	</bean>
	
	<bean id="VelocityDirectiveScriptValidator" class="org.agnitas.emm.core.velocity.scriptvalidator.VelocityDirectiveScriptValidator" />

	<!-- required for some bean def below -->
	<bean id="TargetRepresentation" class="org.agnitas.target.impl.TargetRepresentationImpl" scope="prototype" />

	<bean id="TargetRepresentationFactory" class="org.agnitas.target.impl.TargetRepresentationFactoryImpl" />

	<bean id="TargetNodeFactory" class="org.agnitas.target.impl.TargetNodeFactoryImpl" />

	<bean id="RecipientQueryBuilder" class="org.agnitas.service.RecipientQueryBuilder">
		<property name="targetDao" ref="TargetDao" />
		<property name="columnInfoService" ref="ColumnInfoService" />
	</bean>

	<!-- Beans "TargetNodeString", "TargetNodeDate" and "TargetNodeNumeric" replaced by "TargetNodeFactory" -->

	<bean id="UserForm" class="org.agnitas.beans.impl.UserFormImpl" scope="prototype" />

	<bean id="EmmAction" class="org.agnitas.actions.impl.EmmActionImpl" scope="prototype" />

	<bean id="Mailinglist" class="org.agnitas.beans.impl.MailinglistImpl" scope="prototype" />

	<bean id="TrackableLink" class="org.agnitas.beans.impl.TrackableLinkImpl" scope="prototype" />

	<bean id="Mailing" class="org.agnitas.beans.impl.MailingImpl" scope="prototype">
		<property name="components">
			<map></map>
		</property>
		<property name="dynTags">
			<map></map>
		</property>
		<property name="mediatypes">
			<map></map>
		</property>
		<property name="trackableLinks">
			<map></map>
		</property>
		<property name="maildropStatus">
			<set></set>
		</property>
	</bean>

	<bean id="MaildropEntry" class="org.agnitas.beans.impl.MaildropEntryImpl" scope="prototype" />

	<bean id="MediatypeEmail" class="org.agnitas.beans.impl.MediatypeEmailImpl" scope="prototype" />

	<bean id="Mediatype" class="org.agnitas.beans.impl.MediatypeImpl" scope="prototype" />

	<bean id="MailingComponent" class="org.agnitas.beans.impl.MailingComponentImpl" scope="prototype" />

	<bean id="DeliveryStat" class="org.agnitas.stat.impl.DeliveryStatImpl" scope="prototype">
		<property name="mailingDao" ref="MailingDao" />
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="DeliveryStatFactory" class="org.agnitas.beans.impl.DeliveryStatFactoryImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="CampaignStatEntry" class="org.agnitas.stat.impl.CampaignStatEntryImpl" scope="prototype" />

	<bean id="DomainStat" class="org.agnitas.stat.impl.DomainStatImpl" scope="prototype" />

	<bean id="IPStat" class="org.agnitas.stat.impl.IPStatImpl" scope="prototype">
		<property name="dataSource" ref="dataSource" />
		<property name="targetDao" ref="TargetDao" />
	</bean>

	<bean id="MailingStat" class="org.agnitas.stat.impl.MailingStatImpl" scope="prototype">
		<property name="dataSource" ref="dataSource" />
		<property name="targetDao" ref="TargetDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailingStatEntryFactory" ref="MailingStatEntryFactory" />
		<property name="urlStatEntryFactory" ref="URLStatEntryFactory" />
	</bean>

	<bean id="MailingStatEntry" class="org.agnitas.stat.impl.MailingStatEntryImpl" scope="prototype" />

	<bean id="URLStatEntry" class="org.agnitas.stat.impl.URLStatEntryImpl" scope="prototype" />

	<bean id="Mailgun" class="org.agnitas.backend.MailgunImpl" scope="prototype" />

	<bean id="DynamicTag" class="org.agnitas.beans.impl.DynamicTagImpl" scope="prototype">
		<property name="dynContent">
			<map></map>
		</property>
	</bean>

	<bean id="DynamicTagContent" class="org.agnitas.beans.impl.DynamicTagContentImpl" scope="prototype" />

	<bean id="TagDetails" class="org.agnitas.beans.impl.TagDetailsImpl" scope="prototype" />

	<bean id="Recipient" class="org.agnitas.beans.impl.RecipientImpl" scope="prototype">
		<property name="recipientDao" ref="RecipientDao" />
		<property name="bindingEntryFactory" ref="BindingEntryFactory" />
		<property name="recipientFactory" ref="RecipientFactory" />
		<property name="columnInfoService" ref="ColumnInfoService" />
	</bean>

	<bean id="Campaign" class="org.agnitas.beans.impl.CampaignImpl" scope="prototype" />

	<bean id="BindingEntry" class="org.agnitas.beans.impl.BindingEntryImpl" scope="prototype">
		<property name="bindingEntryDao" ref="BindingEntryDao" />
	</bean>

	<bean id="Target" class="org.agnitas.target.impl.TargetImpl" scope="prototype">
		<property name="targetStructure">
			<ref bean="TargetRepresentation" />
		</property>
	</bean>

	<bean id="DatasourceDescription" class="org.agnitas.beans.impl.DatasourceDescriptionImpl" scope="prototype" />

	<bean id="Title" class="org.agnitas.beans.impl.TitleImpl" scope="prototype" />

	<bean id="ProfileField" class="org.agnitas.beans.impl.ProfileFieldImpl" scope="prototype" />

	<bean id="Company" class="org.agnitas.beans.impl.CompanyImpl" scope="prototype" />

	<bean id="Mailloop" class="org.agnitas.beans.impl.MailloopImpl" scope="prototype" />

	<bean id="Admin" class="org.agnitas.beans.impl.AdminImpl" scope="prototype" />

	<bean id="AdminGroup" class="org.agnitas.beans.impl.AdminGroupImpl" scope="prototype" />

    <bean id="AdminPreferences" class="org.agnitas.beans.impl.AdminPreferencesImpl" scope="prototype" />

	<!-- Password check -->
	<bean id="PasswordCheck" class="org.agnitas.emm.core.commons.password.PasswordCheckImpl">
		<property name="adminDao" ref="AdminDao" />
	</bean>
	
	<!-- UID handling -->

	<bean id="UID" class="org.agnitas.emm.core.commons.uid.impl.UIDImpl" scope="prototype" /> 					<!-- To be removed -->

	<bean id="UIDParser" class="org.agnitas.emm.core.commons.uid.impl.UIDParserImpl">							<!-- To be removed -->
		<property name="companyCache" ref="companyCache" />
		<property name="companyDao" ref="CompanyDao" />
	</bean>

	<bean id="CompanyDaoCache" class="org.agnitas.emm.core.commons.daocache.CompanyDaoCache">
		<property name="companyDao" ref="CompanyDao" />
		<property name="cache" ref="companyCache" />
	</bean>

	<bean id="ExtensibleUIDStringBuilder" class="org.agnitas.emm.core.commons.uid.builder.impl.UID1StringBuilderImpl">
		<property name="companyDaoCache" ref="CompanyDaoCache" />
	</bean>

	<bean id="ExtensibleUIDParser" class="org.agnitas.emm.core.commons.uid.parser.impl.UID1ExtensibleUIDParserImpl">
		<property name="stringBuilder" ref="ExtensibleUIDStringBuilder" />
		<property name="companyDaoCache" ref="CompanyDaoCache" />
	</bean>

	<bean id="ExtensibleUIDService" class="org.agnitas.emm.core.commons.uid.impl.ExtensibleUIDServiceImpl">
		<property name="parser" ref="ExtensibleUIDParser" />
		<property name="stringBuilder" ref="ExtensibleUIDStringBuilder" />
	</bean>

	<bean id="ExportPredef" class="org.agnitas.beans.impl.ExportPredefImpl" scope="prototype" />

	<bean id="CustomerImportStatus" class="org.agnitas.beans.impl.CustomerImportStatusImpl" scope="prototype" />

	<bean id="CharacterEncodingValidator" class="org.agnitas.util.CharacterEncodingValidatorImpl" />

	<!-- Factories -->
	<bean id="ProfileFieldFactory" class="org.agnitas.beans.factory.impl.ProfileFieldFactoryImpl" />

	<bean id="DynamicTagFactory" class="org.agnitas.beans.factory.impl.DynamicTagFactoryImpl" />

	<bean id="DynamicTagContentFactory" class="org.agnitas.beans.factory.impl.DynamicTagContentFactoryImpl" />

	<bean id="MailingComponentFactory" class="org.agnitas.beans.factory.impl.MailingComponentFactoryImpl" />

	<bean id="RecipientFactory" class="org.agnitas.beans.factory.impl.RecipientFactoryImpl">
		<property name="recipientDao" ref="RecipientDao" />
		<property name="columnInfoService" ref="ColumnInfoService" />
	</bean>

	<bean id="PreviewFactory" class="org.agnitas.preview.PreviewFactoryImpl" init-method="createInstance" />

	<bean id="TAGCheckFactory" class="org.agnitas.preview.TAGCheckFactoryImpl" />

	<bean id="targetFactory" class="org.agnitas.target.impl.TargetFactoryImpl">
		<property name="targetRepresentationFactory" ref="TargetRepresentationFactory" />
	</bean>

	<bean id="BindingEntryFactory" class="org.agnitas.beans.factory.impl.BindingEntryFactoryImpl">
		<property name="bindingEntryDao" ref="BindingEntryDao" />
	</bean>

	<bean id="CampaignFactory" class="org.agnitas.beans.factory.impl.CampaignFactoryImpl" />

	<bean id="CampaignStatEntryFactory" class="org.agnitas.beans.factory.impl.CampaignStatEntryFactoryImpl" />

	<bean id="MailloopFactory" class="org.agnitas.beans.factory.impl.MailloopFactoryImpl" />

	<bean id="UserFormFactory" class="org.agnitas.beans.factory.impl.UserFormFactoryImpl" />

	<bean id="MailingFactory" class="org.agnitas.beans.factory.impl.MailingFactoryImpl" />

	<bean id="MailinglistFactory" class="org.agnitas.beans.factory.impl.MailinglistFactoryImpl" />

	<bean id="MaildropEntryFactory" class="org.agnitas.mailing.beans.impl.MailDropEntryFactoryImpl" />

	<bean id="EmmActionFactory" class="org.agnitas.beans.factory.impl.EmmActionFactoryImpl" />

	<bean id="ActionOperationFactory" class="org.agnitas.beans.factory.impl.ActionOperationFactoryImpl" />

	<bean id="DomainStatFactory" class="org.agnitas.beans.factory.impl.DomainStatFactoryImpl" />

	<bean id="MailingStatFactory" class="org.agnitas.beans.factory.impl.MailingStatFactoryImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="targetDao" ref="TargetDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailingStatEntryFactory" ref="MailingStatEntryFactory" />
		<property name="urlStatEntryFactory" ref="URLStatEntryFactory" />
	</bean>

	<bean id="MailingStatEntryFactory" class="org.agnitas.beans.factory.impl.MailingStatEntryFactoryImpl" />

	<bean id="URLStatEntryFactory" class="org.agnitas.beans.factory.impl.URLStatEntryFactoryImpl" />

    <bean id="PreviewImageGeneratorFactory" class="org.agnitas.beans.factory.impl.PreviewImageGeneratorFactoryImpl">
        <property name="mediaFileManager" ref="MediaFileManager" />
    </bean>

    <bean id="AdminPreferencesFactory" class="org.agnitas.beans.factory.impl.AdminPreferencesFactoryImpl" />

	<!-- Caches -->

	<bean id="mailgunCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${mailgun.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${mailgun.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>

	<bean id="imageCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${hostedImage.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${hostedImage.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>

	<bean id="companyCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${company.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${company.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>

	<bean id="mailingCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${archive.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${archive.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>

	<bean id="adrCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${archive.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${archive.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>

	<bean id="subjectCache" class="org.agnitas.util.TimeoutLRUMap">
		<constructor-arg index="0">
			<value>${archive.maxCache}</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>${archive.maxCacheTimeMillis}</value>
		</constructor-arg>
	</bean>
	
	<!--  Validators for target nodes -->
	<bean id="NonValidatingTargetNodeValidator" class="org.agnitas.target.impl.validate.NonValidatorTargetNodeValidator" />
	
	<bean id="MailingIdTargetNodeValidator" class="org.agnitas.target.impl.validate.MailingIdTargetNodeValidator">
		<property name="mailingDao" ref="MailingDao" />
	</bean>
	
	<bean id="IntervalMailingIdTargetNodeValidator" class="org.agnitas.target.impl.validate.IntervalMailingIdTargetNodeValidator">
		<property name="mailingDao" ref="MailingDao" />
	</bean>
	
	<bean id="TargetNodeValidatorKit" class="org.agnitas.target.impl.TargetNodeValidatorKitImpl">
	  	<property name="dateNodeValidator" ref="NonValidatingTargetNodeValidator" />
	  	<property name="intervalMailingNodeValidator" ref="IntervalMailingIdTargetNodeValidator" />
	  	<property name="mailingClickedNodeValidator" ref="MailingIdTargetNodeValidator" />
	  	<property name="mailingOpenedNodeValidator" ref="MailingIdTargetNodeValidator" />
	  	<property name="mailingReceivedNodeValidator" ref="MailingIdTargetNodeValidator" />
	  	<property name="numericNodeValidator" ref="NonValidatingTargetNodeValidator" />
	  	<property name="stringNodeValidator" ref="NonValidatingTargetNodeValidator" />
	</bean>

	<!-- Service definitions -->
	<bean id="sendEmailService" class="org.agnitas.emm.core.util.service.impl.SendEmailServiceImpl" />
	
	<bean id="versionControlService" class="org.agnitas.service.impl.VersionControlServiceImpl">
		<property name="versionControlDao" ref="versionControlDao" />
	</bean>

	<bean id="ColumnInfoService" class="org.agnitas.service.impl.ColumnInfoServiceImpl">
		<property name="profileFieldDao" ref="ProfileFieldDao" />
	</bean>

	<bean id="mailingcontentService" class="org.agnitas.service.impl.MailingContentServiceImpl">
		<property name="columnInfoService" ref="ColumnInfoService" />
	</bean>

	<bean id="ConfigService" class="org.agnitas.emm.core.commons.util.ConfigService">
		<property name="configTableDao" ref="ConfigTableDao" />
	</bean>
	
	<bean id="emmActionService" class="org.agnitas.emm.core.action.service.impl.EmmActionServiceImpl">
		<property name="emmActionDao" ref="EmmActionDao" />
		<property name="emmActionOperationDao" ref="emmActionOperationDao" />
		<property name="emmActionOperationService" ref="emmActionOperationService" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="emmActionOperationService" class="org.agnitas.emm.core.action.service.impl.EmmActionOperationServiceImpl">
		<property name="actionOperationFactory" ref="ActionOperationFactory" />
		<!-- Key value equals to discriminator value in action operation entities-->
		<property name="operations">
			<map>
				<entry key="ExecuteScript" value-ref="actionOperationExecuteScript"/>
				<entry key="UpdateCustomer" value-ref="actionOperationUpdateCustomer"/>
				<entry key="GetCustomer" value-ref="actionOperationGetCustomer"/>
				<entry key="ActivateDoubleOptIn" value-ref="actionOperationActivateDoubleOptIn"/>
				<entry key="SubscribeCustomer" value-ref="actionOperationSubscribeCustomer"/>
				<entry key="UnsubscribeCustomer" value-ref="actionOperationUnsubscribeCustomer"/>
				<entry key="SendMailing" value-ref="actionOperationSendMailing"/>
				<entry key="ServiceMail" value-ref="actionOperationServiceMail"/>
				<entry key="GetArchiveList" value-ref="actionOperationGetArchiveList"/>
				<entry key="GetArchiveMailing" value-ref="actionOperationGetArchiveMailing"/>
			</map>
		</property>
	</bean>
	
	<!-- Action Operations Services -->
	
	<bean id="actionOperationExecuteScript" class="org.agnitas.emm.core.action.service.impl.ActionOperationExecuteScriptImpl">
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="actionOperationUpdateCustomer" class="org.agnitas.emm.core.action.service.impl.ActionOperationUpdateCustomerImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationGetCustomer" class="org.agnitas.emm.core.action.service.impl.ActionOperationGetCustomerImpl" />

	<bean id="actionOperationActivateDoubleOptIn" class="org.agnitas.emm.core.action.service.impl.ActionOperationActivateDoubleOptInImpl">
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="actionOperationSubscribeCustomer" class="org.agnitas.emm.core.action.service.impl.ActionOperationSubscribeCustomerImpl">
		<property name="companyDao" ref="CompanyDao" />
		<property name="uidService" ref="ExtensibleUIDService" />
	</bean>

	<bean id="actionOperationUnsubscribeCustomer" class="org.agnitas.emm.core.action.service.impl.ActionOperationUnsubscribeCustomerImpl">
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="actionOperationSendMailing" class="org.agnitas.emm.core.action.service.impl.ActionOperationSendMailingImpl">
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="actionOperationServiceMail" class="org.agnitas.emm.core.action.service.impl.ActionOperationServiceMailImpl">
		<property name="sendEmailService" ref="sendEmailService" />
	</bean>

	<bean id="actionOperationGetArchiveList" class="org.agnitas.emm.core.action.service.impl.ActionOperationGetArchiveListImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="uidService" ref="ExtensibleUIDService" />
		<property name="mailingDao" ref="MailingDao" />
	</bean>
	
	<bean id="actionOperationGetArchiveMailing" class="org.agnitas.emm.core.action.service.impl.ActionOperationGetArchiveMailingImpl">
    	<property name="mailingCache" ref="mailingCache" />
    	<property name="adrCache" ref="adrCache" />
    	<property name="subjectCache" ref="subjectCache" />
    	<property name="previewFactory" ref="PreviewFactory" />
		<property name="mailingDao" ref="MailingDao" />
	</bean>
	
	<!-- DAO definitions -->

	<bean id="ConfigTableDao" class="org.agnitas.emm.core.commons.util.ConfigTableDao">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="AdminDao" class="org.agnitas.dao.impl.AdminDaoImpl">
		<property name="dataSource" ref="dataSource" />
        <property name="companyDao" ref="CompanyDao" />
        <property name="adminGroupDao" ref="AdminGroupDao" />
	</bean>

	<bean id="AdminGroupDao" class="org.agnitas.dao.impl.AdminGroupDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

    <bean id="AdminPreferencesDao" class="org.agnitas.dao.impl.AdminPreferencesDaoImpl">
		<property name="dataSource" ref="dataSource" />
        <property name="adminPreferencesFactory" ref="AdminPreferencesFactory"/>
    </bean>

	<bean id="BindingEntryDao" class="org.agnitas.dao.impl.BindingEntryDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="BlacklistDao" class="org.agnitas.dao.impl.BlacklistDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="BlacklistService" class="org.agnitas.emm.core.blacklist.service.impl.BlacklistServiceImpl">
		<property name="blacklistDao" ref="BlacklistDao" />
	</bean>

	<bean id="CampaignDao" class="org.agnitas.dao.impl.CampaignDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="campaignStatEntryFactory" ref="CampaignStatEntryFactory" />
	</bean>

	<bean id="CompanyDao" class="org.agnitas.dao.impl.CompanyDaoImpl">
    	<property name="dataSource" ref="dataSource"/>
	</bean>

	<bean id="DynamicTagDao" class="org.agnitas.dao.impl.DynamicTagDaoImpl">
    	<property name="dataSource" ref="dataSource"/>
    </bean>

	<bean id="EmmActionDao" class="org.agnitas.dao.impl.EmmActionDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="emmActionOperationDao" class="org.agnitas.dao.impl.EmmActionOperationDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="actionOperationFactory" ref="ActionOperationFactory" />
		<!-- Key value equals to discriminator value in action operation entities-->
		<property name="daos">
			<map>
				<entry key="ExecuteScript" value-ref="actionOperationExecuteScriptDao"/>
				<entry key="UpdateCustomer" value-ref="actionOperationUpdateCustomerDao"/>
				<entry key="ActivateDoubleOptIn" value-ref="actionOperationActivateDOIDao"/>
				<entry key="GetCustomer" value-ref="actionOperationGetCustomerDao"/>
				<entry key="SubscribeCustomer" value-ref="actionOperationSubscribeCustomerDao"/>
				<entry key="SendMailing" value-ref="actionOperationSendMailingDao"/>
				<entry key="ServiceMail" value-ref="actionOperationServiceMailDao"/>
				<entry key="GetArchiveList" value-ref="actionOperationGetArchiveListDao"/>
			</map>
		</property>
	</bean>
	
	<!-- Action Operations DAO -->

	<bean id="actionOperationExecuteScriptDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationExecuteScriptDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationUpdateCustomerDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationUpdateCustomerDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationActivateDOIDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationActivateDoubleOptInDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationGetCustomerDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationGetCustomerDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationSubscribeCustomerDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationSubscribeCustomerDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationSendMailingDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationSendMailingDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationServiceMailDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationServiceMailDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="actionOperationGetArchiveListDao" class="org.agnitas.emm.core.action.dao.impl.ActionOperationGetArchiveListDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="ExportPredefDao" class="org.agnitas.dao.impl.ExportPredefDaoImpl" />

	<bean id="LoginTrackDao" class="org.agnitas.dao.impl.LoginTrackDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="LoginTrackService" class="org.agnitas.emm.core.logintracking.LoginTrackServiceImpl">
		<property name="loginTrackDao" ref="LoginTrackDao" />
	</bean>
	
	<bean id="LoginTrackServiceRequestHelper" class="org.agnitas.emm.core.logintracking.LoginTrackServiceRequestHelper">
		<property name="loginTrackService" ref="LoginTrackService" />
	</bean>
	

	<bean id="MaildropStatusDao" class="org.agnitas.dao.impl.MaildropStatusDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="MailingComponentDao" class="org.agnitas.dao.impl.MailingComponentDaoImpl">
    	<property name="dataSource" ref="dataSource" />
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="MailingDao" class="org.agnitas.dao.impl.MailingDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="MailinglistDao" class="org.agnitas.dao.impl.MailinglistDaoImpl">
		<property name="dataSource" ref="dataSource" />
    	<property name="targetDao" ref="TargetDao" />
	</bean>

	<bean id="MailloopDao" class="org.agnitas.dao.impl.MailloopDaoImpl" />

	<bean id="OnepixelDao" class="org.agnitas.dao.impl.OnepixelDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="ProfileFieldDao" class="org.agnitas.dao.impl.ProfileFieldDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="RecipientDao" class="org.agnitas.dao.impl.RecipientDaoImpl">
    	<property name="dataSource" ref="dataSource" />
		<property name="companyDao" ref="CompanyDao" />
        <property name="columnInfoService" ref="ColumnInfoService" />
        <property name="bindingEntryDao" ref="BindingEntryDao" />
    </bean>

	<bean id="TargetDao" class="org.agnitas.dao.impl.TargetDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="targetFactory" ref="targetFactory" />
   		<property name="targetRepresentationFactory" ref="TargetRepresentationFactory" />
	</bean>

	<bean id="TitleDao" class="org.agnitas.dao.impl.TitleDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="TrackableLinkDao" class="org.agnitas.dao.impl.TrackableLinkDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="UserFormDao" class="org.agnitas.dao.impl.UserFormDaoImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean id="UserFormService" class="org.agnitas.emm.core.userforms.impl.UserformServiceImpl">
		<property name="userFormDao" ref="UserFormDao" />
	</bean>

	<bean id="versionControlDao" class="org.agnitas.dao.impl.VersionControlDaoImpl" />

	<bean id="EmmLayoutBaseDao" class="org.agnitas.dao.impl.EmmLayoutBaseDaoImpl" />

	<bean id="pluginDao" class="org.agnitas.emm.extension.dao.impl.PluginDaoImpl">	<!--  Do not remove, this is used by ExtensionSystemInitializationContextListener -->
		<property name="dataSource" ref="dataSource" />
	</bean>

    <bean id="AutoImportDao" class="org.agnitas.emm.core.autoimport.dao.impl.AutoImportDaoImpl">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="AutoExportDao" class="org.agnitas.emm.core.autoexport.dao.impl.AutoExportDaoImpl">
        <property name="dataSource" ref="dataSource" />
    </bean>

	<!-- Link checker -->

	<bean id="LinkcheckerDao" class="org.agnitas.dao.impl.LinkcheckerDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="linkcheckService" class="org.agnitas.service.LinkcheckService">
		<property name="linkcheckerDao" ref="LinkcheckerDao" />
	</bean>

	<bean id="DocMappingDao" class="org.agnitas.dao.impl.DocMappingDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="workerExecutorService" class="java.util.concurrent.ScheduledThreadPoolExecutor">
		<constructor-arg value="10" type="int" />
	</bean>

	<bean id="futureHolder" class="java.util.concurrent.ConcurrentHashMap" />

	<!-- struts action mappings comeing soon ! -->

	<bean id="onlinehelp.languages" class="java.lang.String">
		<constructor-arg value="${onlinehelp.languages}" />
	</bean>

    <bean id="ScriptHelper" class="org.agnitas.util.ScriptHelper" scope="prototype" />

	<bean id="NewImportWizardService" class="org.agnitas.service.impl.NewImportWizardServiceImpl" scope="prototype" init-method="initRules">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
		<property name="importProfileDao" ref="ImportProfileDao" />
		<property name="importLoggerDao" ref="ImportLoggerDao" />
		<property name="recipientDao" ref="RecipientDao" />
		<property name="status" ref="CustomerImportStatus" />
		<property name="blockSize" value="2000" />
		<property name="validatorRulesXml" value="/org/agnitas/service/csv/validator/validator-rules.xml" />
	</bean>

    <bean id="AutoImportService" class="org.agnitas.emm.core.autoimport.service.AutoImportService">
        <property name="autoImportDao" ref="AutoImportDao" />
        <property name="importProfileDao" ref="ImportProfileDao" />
        <property name="mailinglistDao" ref="MailinglistDao" />
        <property name="adminDao" ref="AdminDao" />
        <property name="importService" ref="NewImportWizardService" />
    </bean>

    <bean id="AutoExportService" class="org.agnitas.emm.core.autoexport.service.AutoExportService">
        <property name="autoExportDao" ref="AutoExportDao" />
        <property name="exportPredefDao" ref="ExportPredefDao" />
        <property name="adminDao" ref="AdminDao" />
        <property name="exportWizardService" ref="ExportWizardService" />
    </bean>

    <bean id="ExportWizardService" class="org.agnitas.emm.core.autoexport.service.ExportWizardService">
        <property name="dataSource" ref="dataSource" />
        <property name="targetDao" ref="TargetDao" />
    </bean>

	<bean id="UserActivityLogDao" class="org.agnitas.emm.core.useractivitylog.dao.UserActivityLogDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="UserActivityLogService" class="org.agnitas.emm.core.useractivitylog.service.DbUserActivityLogServiceImpl" scope="prototype">
		<property name="userActivityLogDao" ref="UserActivityLogDao" />
	</bean>

	<bean id="ImportRecipientsDao" class="org.agnitas.dao.impl.ImportRecipientsDaoImpl" scope="prototype"></bean>

	<bean id="ImportLoggerDao" class="org.agnitas.dao.impl.ImportLoggerDaoImpl" scope="prototype"></bean>

	<!-- new import beans -->

	<bean id="ImportProfile" class="org.agnitas.beans.impl.ImportProfileImpl" scope="prototype"></bean>

	<bean id="ColumnMapping" class="org.agnitas.beans.impl.ColumnMappingImpl" scope="prototype"></bean>

	<bean id="ImportProfileDao" class="org.agnitas.dao.impl.ImportProfileDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

    <bean id="EmbeddedClickStatDao" class="org.agnitas.ecs.backend.dao.impl.EmbeddedClickStatDaoImpl">
        <property name="dataSource" ref="dataSource"/>
    </bean>

	<bean id="EmbeddedClickStatService" class="org.agnitas.ecs.backend.service.impl.EmbeddedClickStatServiceImpl" scope="prototype">
		<property name="embeddedClickStatDao" ref="EmbeddedClickStatDao" />
		<property name="previewFactory" ref="PreviewFactory" />
	</bean>

	<bean id="EcsRecipientsProvider" class="org.agnitas.ecs.service.impl.EcsRecipientsProviderImpl" scope="prototype">
		<property name="recipientDao" ref="RecipientDao" />
	</bean>
	
	<bean id="JobQueueService" class="org.agnitas.service.JobQueueService">
		<property name="jobQueueDao" ref="JobQueueDao" />
	</bean>
	
	<bean id="JobQueueDao" class="org.agnitas.dao.impl.JobQueueDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="imageHelperService" class="org.agnitas.emm.core.imagehelper.ImageHelperService" scope="prototype">
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="MailingTargetExpressionLocatorDao" class="org.agnitas.emm.core.target.dao.impl.MailingTargetExpressionLocatorDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="ExportPredefTargetGroupLocatorDao" class="org.agnitas.emm.core.target.dao.impl.ExportPredefTargetGroupLocatorDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="MailingComponentTargetGroupLocatorDao" class="org.agnitas.emm.core.target.dao.impl.MailingComponentTargetGroupLocatorDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="MailingContentTargetGroupLocatorDao" class="org.agnitas.emm.core.target.dao.impl.MailingContentTargetGroupLocatorDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="MailingTargetGroupLocator" class="org.agnitas.emm.core.target.service.impl.MailingTargetGroupLocator">
		<!-- property name="mailingService" ref="mailingService" /-->
		<property name="mailingTargetExpressionLocatorDao" ref="MailingTargetExpressionLocatorDao" />
		<property name="targetService" ref="targetService" />
	</bean>
	
	<bean id="ExportPredefTargetGroupLocator" class="org.agnitas.emm.core.target.service.impl.ExportPredefTargetGroupLocator">
		<property name="exportPredefTargetGroupLocatorDao" ref="ExportPredefTargetGroupLocatorDao" />
	</bean>
	
	<bean id="MailingComponentTargetGroupLocator" class="org.agnitas.emm.core.target.service.impl.MailingComponentTargetGroupLocator">
		<property name="mailingComponentTargetGroupLocatorDao" ref="MailingComponentTargetGroupLocatorDao" />
	</bean>
	
	<bean id="MailingContentTargetGroupLocator" class="org.agnitas.emm.core.target.service.impl.MailingContentTargetGroupLocator">
		<property name="mailingContentTargetGroupLocatorDao" ref="MailingContentTargetGroupLocatorDao" />
	</bean>

	<bean id="TargetGroupLocator" class="org.agnitas.emm.core.target.service.impl.TargetGroupLocatorChain">
		<property name="targetGroupLocators">
			<list>
				<ref bean="MailingTargetGroupLocator" />
				<ref bean="ExportPredefTargetGroupLocator" />
				<ref bean="MailingComponentTargetGroupLocator" />
				<ref bean="MailingContentTargetGroupLocator" />
			</list>
		</property>
	</bean>

	<bean id="targetService" class="org.agnitas.emm.core.target.service.impl.TargetServiceImpl">
		<property name="targetDao" ref="TargetDao" />
		<property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="targetGroupLocator" ref="TargetGroupLocator" />
	</bean>

	<bean id="DownloadService" class="org.agnitas.emm.core.download.service.DownloadServiceImpl" />
	
    <bean id="mailingService" class="org.agnitas.emm.core.mailing.service.impl.MailingServiceImpl">
        <property name="userActivityLogService" ref="UserActivityLogService" />
    	<lookup-method name="getSelfReference" bean="mailingService"/>
    </bean>
    
	<bean id="TagDao" class="org.agnitas.dao.impl.TagDaoImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="TagSyntaxChecker" class="org.agnitas.preview.TagSyntaxChecker">
		<property name="tagDao" ref="TagDao" />
	</bean>
</beans>
